{% load static %}

<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'webapp/style.css' %}">

    <title>fooDA</title>
</head>
<body>
    <header></header>
    <main class="section">
        <div class="main-container">
            <div class="position-container">
                <div class="start-menu">
                    <h2>–í—ã–±–µ—Ä–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç</h2>

                    <button class="main-button" id="get-combo">–ü–æ–∏—Å–∫</button>
                    <div id="result"></div>
                      <details class="but-detalis">
                        <summary class="but-summary"><span class="summary-label">–î–æ–±–∞–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è</span></summary>
                        <p>–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–µ–¥–≤—ã–±—Ä–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—É–Ω–∫—Ç—ã:</p>
                    <div class="dropdown--center">
                      <div class="dropdown">
                        <details class="multi-select">
                          <summary><span class="summary-label">–í—ã–±–µ—Ä–∏—Ç–µ –∫—É—Ö–Ω—é, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –∏—Å–∫–ª—é—á–∏—Ç—å:</span></summary>
                          <div class="options">
                            <label><input type="checkbox" class="cuisine-checkbox" value="–†—É—Å—Å–∫–∞—è">–†—É—Å—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è">–ò—Ç–∞–ª—å—è–Ω—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∞—è">–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è">–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–°–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∞—è">–°–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–ê–∑–∏–∞—Ç—Å–∫–∞—è">–ê–∑–∏–∞—Ç—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–ú–µ–∫—Å–∏–∫–∞–Ω—Å–∫–∞—è">–ú–µ–∫—Å–∏–∫–∞–Ω—Å–∫–∞—è</label>
                            <label><input type="checkbox" class="cuisine-checkbox" value="–ò–Ω–¥–∏–π—Å–∫–∞—è">–ò–Ω–¥–∏–π—Å–∫–∞—è</label>
                          </div>
                        </details>
                      </div>

                      <div class="dropdown">
                        <details class="multi-select">
                          <summary><span class="summary-label">–í—ã–±–µ—Ä–∏—Ç–µ –µ–¥—É, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—Ç–∏—Ç–µ –∏—Å–∫–ª—é—á–∏—Ç—å:</span></summary>
                          <input type="text" id="ingredient-search" placeholder="–ü–æ–∏—Å–∫..." class="search-box">
                          <div class="options" id="ingredient-options">
                            <label><input type="checkbox" class="ingredient-checkbox" value="–±–µ–∫–æ–Ω">–±–µ–∫–æ–Ω</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–≤–µ—Ç—á–∏–Ω–∞">–≤–µ—Ç—á–∏–Ω–∞</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–≥—Ä–∏–±—ã">–≥—Ä–∏–±—ã</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–∫–∞–±–∞—á–∫–∏">–∫–∞–±–∞—á–∫–∏</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–∫–æ—Ä–∏—Ü–∞">–∫–æ—Ä–∏—Ü–∞</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–∫—É—Ä–∏—Ü–∞">–∫—É—Ä–∏—Ü–∞</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–ª–æ—Å–æ—Å—å">–ª–æ—Å–æ—Å—å</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="—Ä—ã–±–∞">—Ä—ã–±–∞</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="—Å—ã—Ä">—Å—ã—Ä</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="—á–∏–ª–∏">—á–∏–ª–∏</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–º–æ–ª–æ–∫–æ">–º–æ–ª–æ–∫–æ</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–º–∞–π–æ–Ω–µ–∑">–º–∞–π–æ–Ω–µ–∑</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–º—É–∫–∞">–º—É–∫–∞</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="–º—è—Å–æ">–º—è—Å–æ</label>
                            <label><input type="checkbox" class="ingredient-checkbox" value="—á–∏–ª–∏">—á–∏–ª–∏</label>
                          </div>
                        </details>
                      </div>

                       <div class="dropdown">
                        <details class="multi-select">
                          <summary><span class="summary-label">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–ø–∏—Ç–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–∫–ª—é—á–∏—Ç—å:</span></summary>
                          <div class="options">
                            <label><input type="checkbox" class="drink-category-checkbox" value="–ì–æ—Ä—è—á–∏–µ">–ì–æ—Ä—è—á–∏–µ –Ω–∞–ø–∏—Ç–∫–∏</label>
                            <label><input type="checkbox" class="drink-category-checkbox" value="–•–æ–ª–æ–¥–Ω—ã–µ">–•–æ–ª–æ–¥–Ω—ã–µ –Ω–∞–ø–∏—Ç–∫–∏ </label>
                            <label><input type="checkbox" class="drink-category-checkbox" value="–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞">–ë–µ–∑ —Å–∞—Ö–∞—Ä–∞</label>
                            <label><input type="checkbox" class="drink-category-checkbox" value="–ö–æ—Ñ–µ–π–Ω—ã–µ">–ö–æ—Ñ–µ–π–Ω—ã–µ</label>
                          </div> 
                        </details>
                      </div>
                      <button class="main-button" id="get-combo-exc">–ü–æ–∏—Å–∫ —Å –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º–∏</button>
                      </details>
                    </div>    
                </div>
            </div>
        </div>
    </main>
    <footer></footer>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
$(document).ready(function () {

  $('.multi-select').each(function () {
    const $dropdown = $(this);
    const $summaryLabel = $dropdown.find('.summary-label');
    const $checkboxes = $dropdown.find('input[type="checkbox"]');
    const defaultText = $summaryLabel.text();

    $checkboxes.on('change', function () {
      const checked = $checkboxes.filter(':checked');
      if (checked.length === 0) {
        $summaryLabel.text(defaultText);
      } else {
        const selectedLabels = checked.map(function () {
          return $(this).parent().text().trim();
        }).get();
        $summaryLabel.text('–í—ã–±—Ä–∞–Ω–æ: ' + selectedLabels.join(', '));
      }
    });
  });

  $('#get-combo').click(function () {
    $.get('/api/random-combo/', function (data) {
      $('#result').html(
        `<h3>–ë–ª—é–¥–æ: ${data.dish.name} (${data.dish.cuisine})</h3>
         <p>–°–æ—Å—Ç–∞–≤: ${data.dish.ingredients}</p>
         <h3>–ù–∞–ø–∏—Ç–æ–∫: ${data.drink.name} (${data.drink.category})</h3>
         <p>–°–æ—Å—Ç–∞–≤: ${data.drink.ingredients}</p>`
      );
    });
  });

});

 function getExcludedCuisines() {
    let excluded = [];
    $('.multi-select input[type="checkbox"]:checked').each(function () {
      excluded.push($(this).val());
    });
    console.log("–ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫—É—Ö–Ω–∏:", excluded);
    return excluded;
  }

function getCheckedValues(selector) {
  let result = [];
  $(selector).each(function () {
    result.push($(this).val());
  });
  return result;
}

function collectFilters() {
  return {
    exclude_cuisines: getCheckedValues('.cuisine-checkbox:checked'),
    exclude_ingredients: getCheckedValues('.ingredient-checkbox:checked'),
    exclude_drink_categories: getCheckedValues('.drink-category-checkbox:checked'),
  };
}

// üîπ –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤
$('#get-combo').click(function () {
  $.get('/api/random-combo/', function (data) {
    $('#result').html(
      `<h3>–ë–ª—é–¥–æ: ${data.dish.name} (${data.dish.cuisine})</h3>
       <p>–°–æ—Å—Ç–∞–≤: ${data.dish.ingredients}</p>
       <h3>–ù–∞–ø–∏—Ç–æ–∫: ${data.drink.name} (${data.drink.category})</h3>
       <p>–°–æ—Å—Ç–∞–≤: ${data.drink.ingredients}</p>`
    );
  }).fail(function () {
    $('#result').html('<p style="color:red;">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –±–ª—é–¥–∞</p>');
  });
});

$('#get-combo-exc').click(function () {
  const filters = collectFilters();

  $.ajax({
    url: '/api/random-combo-filtered/',
    method: 'POST',
    data: JSON.stringify(filters),
    contentType: 'application/json',
    success: function (data) {
      $('#result').html(
        `<h3>–ë–ª—é–¥–æ: ${data.dish.name} (${data.dish.cuisine})</h3>
         <p>–°–æ—Å—Ç–∞–≤: ${data.dish.ingredients}</p>
         <h3>–ù–∞–ø–∏—Ç–æ–∫: ${data.drink.name} (${data.drink.category})</h3>
         <p>–°–æ—Å—Ç–∞–≤: ${data.drink.ingredients}</p>`
      );
    },
    error: function (xhr) {
      const err = xhr.responseJSON?.error || '–û—à–∏–±–∫–∞';
      $('#result').html(`<p style="color:red;">${err}</p>`);
    }
  });
});

 $('#ingredient-search').on('input', function () {
    const search = $(this).val().toLowerCase();
    $('#ingredient-options label').each(function () {
      const text = $(this).text().toLowerCase();
      if (text.includes(search)) {
        $(this).show();
      } else {
        $(this).hide();
      }
    });
  });
</script>
</body>
</html>